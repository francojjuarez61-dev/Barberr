<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarberApp - Glass Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            /* Fondo colorido animado */
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Efecto Glass (Vidrio) */
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }
        .glass-input:focus {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        /* Estilos para el Select */
        select.glass-input option {
            background-color: #1f2937; /* Gris oscuro para las opciones */
            color: white;
        }

        /* Botones de D√≠as */
        .day-btn { transition: all 0.2s ease; }
        .day-btn.active {
            background: white;
            color: #e73c7e; /* Color rosado del tema */
            font-weight: 800;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        /* Botones de Control (+/-) */
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.1s;
            user-select: none;
            touch-action: manipulation;
        }
        .control-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        /* Toggle */
        .peer:checked ~ .peer-checked\:bg-glass-accent { background-color: rgba(255, 255, 255, 0.9); }
        .peer:checked ~ .peer-checked\:translate-x-full { transform: translateX(100%); }

        /* Animaci√≥n suave */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ocultar flechas del input number est√°ndar */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        /* Estilos espec√≠ficos Modal Calculadora */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }
        .calc-card {
            transition: transform 0.1s;
        }
        .calc-card:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="min-h-full p-4 md:p-8 text-white selection:bg-pink-500 selection:text-white">

    <div class="max-w-3xl mx-auto space-y-8 pb-16">
        
        <!-- Encabezado -->
        <header class="text-center space-y-2 pt-6">
            <h1 class="text-5xl font-black tracking-tight drop-shadow-md">Barber<span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-200">App</span></h1>
            <p class="text-white/80 font-medium">Calculadora de Metas</p>
            
            <!-- Indicador de Guardado -->
            <div id="saveIndicator" class="opacity-0 transition-opacity duration-300 text-xs font-bold text-white/90 bg-black/20 inline-flex items-center gap-1 px-3 py-1 rounded-full mt-2 backdrop-blur-sm">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                Guardado
            </div>
        </header>

        <!-- 1. Configuraci√≥n Principal -->
        <section class="glass-panel rounded-3xl p-6 md:p-8 space-y-8">
            <div class="flex items-center gap-3 border-b border-white/10 pb-4 mb-4">
                <span class="bg-white/20 w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">1</span>
                <h2 class="text-xl font-bold text-white">Configuraci√≥n</h2>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                
                <!-- SELECCI√ìN DE PRECIO DE REFERENCIA -->
                <div class="space-y-3">
                    <label class="text-sm font-bold text-white/70 uppercase tracking-wider">Usar precio de referencia:</label>
                    
                    <!-- Selector con Data-Name para los textos -->
                    <select id="servicioSelector" class="glass-input w-full rounded-xl p-3 font-medium outline-none cursor-pointer">
                        <option value="12000" data-name="Cortes" selected>Corte ($12.000)</option>
                        <option value="15000" data-name="Cortes + Barba">Corte + Barba ($15.000)</option>
                        <option value="8000" data-name="Barbas">Barba ($8.000)</option>
                        <option value="2000" data-name="Dise√±os">Dise√±os (desde $2.000)</option>
                    </select>

                    <!-- Input num√©rico (se actualiza solo o se edita) -->
                    <div class="relative group">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 text-xl font-light">$</span>
                        <input type="number" id="precioReferencia" class="save-input glass-input w-full rounded-2xl pl-8 p-4 text-2xl font-bold outline-none transition-all placeholder-white/20" value="12000">
                    </div>
                    <p class="text-xs text-white/50">Tu meta se dividir√° por este valor para saber cu√°ntos trabajos necesit√°s.</p>
                </div>

                <!-- Meta L√≠quida -->
                <div class="space-y-3">
                    <label class="text-sm font-bold text-white/70 uppercase tracking-wider">Tu Ganancia Objetivo (55%)</label>
                    <div class="relative group">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 text-xl font-light">$</span>
                        <input type="number" id="metaLiquida" class="save-input glass-input w-full rounded-2xl pl-8 p-4 text-2xl font-bold outline-none transition-all placeholder-white/20" placeholder="Ej: 200000">
                    </div>
                </div>
            </div>

            <!-- Selector de D√≠as -->
            <div class="space-y-4 pt-4">
                <label class="text-sm font-bold text-white/70 uppercase tracking-wider">D√≠as de Trabajo</label>
                <div class="flex flex-wrap justify-between gap-2" id="daySelectorContainer">
                    <button type="button" data-day="0" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">L</button>
                    <button type="button" data-day="1" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">M</button>
                    <button type="button" data-day="2" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">M</button>
                    <button type="button" data-day="3" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">J</button>
                    <button type="button" data-day="4" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">V</button>
                    <button type="button" data-day="5" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">S</button>
                    <button type="button" data-day="6" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">D</button>
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="flex flex-col sm:flex-row gap-4 pt-2">
                <button id="calcularBtn" class="flex-1 bg-white text-pink-600 hover:bg-white/90 font-extrabold py-4 px-6 rounded-2xl text-lg shadow-lg shadow-black/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                    Calcular Plan
                </button>
                <button id="resetBtn" class="sm:w-auto glass-input hover:bg-white/10 text-white font-bold py-4 px-6 rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    Reiniciar Semana
                </button>
            </div>
        </section>

        <!-- Error Msg -->
        <div id="error" class="hidden fade-in bg-red-500/80 backdrop-blur-md border border-white/20 text-white p-4 rounded-2xl text-center font-bold shadow-lg">
            ‚ö†Ô∏è Ingres√° una Meta ($) y seleccion√° al menos un d√≠a para empezar.
        </div>

        <!-- 2. Tu Plan (Resultado) -->
        <section id="resultado" class="hidden fade-in space-y-6">
            
            <!-- Objetivo Principal Card -->
            <div class="glass-panel rounded-3xl p-8 text-center relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                
                <h3 class="text-white/60 text-lg mb-2 font-medium">Objetivo Diario de Facturaci√≥n</h3>
                <p class="text-5xl md:text-6xl font-black text-white mb-6 drop-shadow-lg" id="resMetaDiaria">$0</p>
                
                <div class="inline-flex items-center gap-4 bg-black/20 p-2 pr-6 rounded-full border border-white/10 backdrop-blur-sm">
                    <div class="bg-white text-pink-600 w-12 h-12 rounded-full flex items-center justify-center font-black text-xl shadow-lg" id="resCortesPorDia">0</div>
                    <div class="text-left">
                        <!-- TEXTO DIN√ÅMICO AQU√ç -->
                        <p id="lblServicioMeta" class="text-sm text-white font-bold leading-none">Cortes</p>
                        <p class="text-xs text-white/60 leading-none mt-1">por d√≠a aprox.</p>
                    </div>
                </div>

                <!-- Aclaraci√≥n Ganancia Real -->
                <div class="mt-8 pt-6 border-t border-white/10 text-sm">
                    <p class="text-white/80">
                        *Si cumpl√≠s esa cantidad exacta de servicios, tu ganancia real ser√°:
                    </p>
                    <div class="flex items-center justify-center gap-2 mt-1">
                        <span id="resGananciaProyectada" class="text-2xl font-bold text-white">$0</span>
                        <span id="resDiferenciaGanancia" class="bg-green-500/20 text-green-300 px-2 py-0.5 rounded text-xs font-bold border border-green-500/30">+ $0 extra</span>
                    </div>
                </div>
            </div>

            <!-- Cards Detalles -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="glass-panel p-5 rounded-2xl">
                    <p class="text-xs text-white/50 uppercase font-bold tracking-wider mb-1">Meta Original (55%)</p>
                    <p class="text-2xl font-bold text-white" id="resMetaLiquida">$0</p>
                </div>
                <div class="glass-panel p-5 rounded-2xl">
                    <p class="text-xs text-white/50 uppercase font-bold tracking-wider mb-1">Facturaci√≥n Total</p>
                    <p class="text-xl font-bold text-white" id="resTotalFacturar">$0</p>
                </div>
                <div class="glass-panel p-5 rounded-2xl">
                    <p class="text-xs text-white/50 uppercase font-bold tracking-wider mb-1">Comisi√≥n (45%)</p>
                    <p class="text-xl font-bold text-white" id="resComision">$0</p>
                </div>
            </div>
        </section>

        <!-- 3. Seguimiento Diario -->
        <section id="seguimiento" class="hidden fade-in glass-panel rounded-3xl p-6 md:p-8">
            <div class="flex items-center gap-3 border-b border-white/10 pb-4 mb-6">
                <span class="bg-white/20 w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">2</span>
                <h2 class="text-xl font-bold text-white">Seguimiento Real</h2>
            </div>
            
            <!-- Contenedor din√°mico de Inputs -->
            <div id="inputsDiasContainer" class="grid grid-cols-1 gap-6 mb-8">
                <!-- Se llena con JS y ahora tiene botones de control Y CALCULADORA -->
            </div>

            <!-- Totales Real Time -->
            <div class="bg-black/20 rounded-2xl p-6 border border-white/5 space-y-6 backdrop-blur-sm">
                <!-- Sumas -->
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pb-6 border-b border-white/10">
                    <div class="text-center sm:text-left">
                        <p class="text-xs text-white/50 uppercase font-bold">Total Facturado</p>
                        <p class="text-3xl font-bold text-white" id="resTotalReal">$0</p>
                    </div>
                    <div class="text-center sm:text-right">
                        <p class="text-xs text-green-300 uppercase font-bold">Tu Ganancia L√≠quida</p>
                        <p class="text-3xl font-bold text-green-400 drop-shadow-sm" id="resGananciaReal">$0</p>
                    </div>
                </div>

                <!-- Estado de la Meta -->
                <div id="estadoMetaContainer">
                    <!-- Estado: Faltante -->
                    <div id="resFaltanteWrapper" class="hidden text-center space-y-4">
                        <div>
                            <p class="text-sm text-white/70">Te falta para el objetivo (Ganancia):</p>
                            <p class="text-4xl font-bold text-white" id="resFaltante">$0</p>
                        </div>
                        
                        <div id="cortesFaltantesWrapper" class="inline-block bg-white/10 px-6 py-2 rounded-full border border-white/10 backdrop-blur-md">
                            <span class="text-sm font-medium">
                                Equivale a facturar 
                                <span id="resCortesFaltantes" class="font-bold text-xl mx-1 text-white">0</span> 
                                <!-- TEXTO DIN√ÅMICO AQU√ç -->
                                <span id="lblServicioFaltante">Cortes</span>
                                m√°s
                            </span>
                        </div>
                        
                        <div id="promedioFaltanteWrapper" class="pt-2">
                             <p class="text-xs text-white/60">
                                Necesit√°s <span class="text-white font-bold underline">facturar</span> <span id="resPromedioFaltante" class="text-white font-bold">$0</span> en cada d√≠a restante.
                                <!-- TEXTO DIN√ÅMICO AQU√ç -->
                                <span id="resPromedioCortesWrapper" class="block mt-1 text-white/80">(aprox. <span id="resPromedioCortes" class="font-bold text-white">0</span> <span id="lblServicioPromedio">Cortes</span> diarios)</span>
                             </p>
                        </div>
                    </div>

                    <!-- Estado: √âxito -->
                    <div id="mensajeExito" class="hidden text-center py-4">
                        <div class="inline-flex p-4 bg-green-500/20 rounded-full mb-4 border border-green-500/30 shadow-[0_0_20px_rgba(34,197,94,0.3)]">
                            <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h3 class="text-2xl font-black text-white mb-1">¬°META LOGRADA! üéâ</h3>
                        <p class="text-white/80">Extra generado: <span id="resExtra" class="font-bold text-white">$0</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Gu√≠a R√°pida (Toggle) -->
        <section class="glass-panel rounded-2xl overflow-hidden">
            <label for="toggleGuia" class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition-colors">
                <div class="flex items-center gap-3">
                    <span class="bg-white/20 w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold">?</span>
                    <h2 class="text-lg font-bold text-white">Ideas para Crecer</h2>
                </div>
                <div class="relative">
                    <input type="checkbox" id="toggleGuia" class="peer sr-only">
                    <div class="w-11 h-6 bg-black/30 rounded-full peer peer-focus:ring-2 peer-focus:ring-white/50 transition-all"></div>
                    <div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-all duration-300 peer-checked:translate-x-full peer-checked:bg-glass-accent"></div>
                </div>
            </label>

            <div id="contenidoGuia" class="max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
                <div class="p-6 border-t border-white/10 space-y-6 text-white/80 text-sm leading-relaxed">
                    <!-- ... contenido gu√≠a ... -->
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-white/5 p-4 rounded-xl">
                            <h3 class="text-white font-bold mb-3 uppercase text-xs tracking-wider opacity-70">Ticket Promedio</h3>
                            <ul class="space-y-2">
                                <li class="flex gap-2">‚ú® Ofrec√© combos (Corte + Barba).</li>
                                <li class="flex gap-2">‚ú® Vend√© productos (Cera, Aceite).</li>
                            </ul>
                        </div>
                        <div class="bg-white/5 p-4 rounded-xl">
                            <h3 class="text-white font-bold mb-3 uppercase text-xs tracking-wider opacity-70">Frecuencia</h3>
                            <ul class="space-y-2">
                                <li class="flex gap-2">üìÖ Re-agend√° al terminar.</li>
                                <li class="flex gap-2">üì± Mand√° recordatorios.</li>
                            </ul>
                        </div>
                        <div class="bg-white/5 p-4 rounded-xl">
                            <h3 class="text-white font-bold mb-3 uppercase text-xs tracking-wider opacity-70">Nuevos Clientes</h3>
                            <ul class="space-y-2">
                                <li class="flex gap-2">üìç Google Maps activo.</li>
                                <li class="flex gap-2">üì∏ Reels de "Antes y Despu√©s".</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <p class="text-center text-white/30 text-xs mt-8 font-medium">Tus datos se guardan autom√°ticamente.</p>

    </div>

    <!-- MODAL CALCULADORA (Floating Glass) -->
    <div id="calculatorModal" class="modal-overlay">
        <div class="glass-panel w-full max-w-lg mx-4 rounded-3xl overflow-hidden flex flex-col max-h-[90vh]">
            
            <!-- Calc Header -->
            <div class="p-5 border-b border-white/10 flex justify-between items-center bg-black/20">
                <div class="flex items-center gap-3">
                    <div class="text-cyan-400 bg-cyan-400/20 p-2 rounded-lg">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-white text-lg">Calculadora de Caja</h3>
                        <p class="text-xs text-white/50">Cuenta tus billetes</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-xs text-white/50 uppercase tracking-widest font-bold">Total Acumulado</p>
                    <p id="calcTotalDisplay" class="text-3xl font-black text-cyan-400 drop-shadow-md">$0</p>
                </div>
            </div>

            <!-- Calc Body -->
            <div class="p-4 overflow-y-auto flex-1 bg-black/10">
                <!-- Add New Denomination Input (Hidden by default) -->
                <div id="addDenomContainer" class="hidden mb-4 p-3 bg-white/5 rounded-xl border border-white/10">
                    <div class="flex gap-2">
                        <input type="number" id="newDenomInput" class="glass-input w-full p-2 rounded-lg" placeholder="Valor (ej: 2000)">
                        <button onclick="calcAddNew()" class="bg-emerald-500/80 hover:bg-emerald-500 text-white px-4 rounded-lg font-bold">OK</button>
                        <button onclick="toggleAddDenom()" class="bg-white/10 hover:bg-white/20 text-white px-3 rounded-lg">X</button>
                    </div>
                </div>

                <div id="calcGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                    <!-- JS genera las tarjetas aqu√≠ -->
                </div>
            </div>

            <!-- Calc Footer -->
            <div class="p-4 border-t border-white/10 bg-black/20 flex gap-2 justify-between">
                <div class="flex gap-2">
                    <button onclick="toggleAddDenom()" class="p-3 bg-white/5 hover:bg-white/10 rounded-xl text-white/60 hover:text-emerald-400 border border-white/5 transition-colors" title="Agregar Billete">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    </button>
                    <button onclick="calcReset()" class="p-3 bg-white/5 hover:bg-white/10 rounded-xl text-white/60 hover:text-rose-400 border border-white/5 transition-colors" title="Reiniciar">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                    </button>
                </div>
                <div class="flex gap-2 w-full justify-end">
                    <button onclick="closeCalculator()" class="px-6 py-3 rounded-xl font-bold text-white/70 hover:bg-white/10 transition-colors">Cancelar</button>
                    <button onclick="applyCalculatorTotal()" class="px-6 py-3 rounded-xl font-bold bg-white text-pink-600 hover:bg-white/90 shadow-lg transition-transform active:scale-95">Aplicar Total</button>
                </div>
            </div>
        </div>
    </div>

    <!-- L√ìGICA DE LA APLICACI√ìN -->
    <script>
        // --- 1. CONFIGURACI√ìN Y VARIABLES ---
        
        let metaLiquidaGoal = 0;
        let precioCorteGoal = 0;
        let diasTrabajoGoal = 0;
        let serviceName = 'Cortes'; 
        const tuPorcentaje = 0.55; 
        const comisionPorcentaje = 0.45; 
        
        const daysNames = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
        let selectedDays = []; 

        const staticIdsToSave = ['precioReferencia', 'metaLiquida'];

        // VARIABLES CALCULADORA
        let calcDenominations = [60000, 50000, 30000, 20000, 15000, 14000, 12000, 8000, 6000];
        let calcCounts = {};
        let currentCalcInputId = null; // Input destino

        // --- 2. FUNCIONES UTILITARIAS ---

        const formatCurrency = (num) => {
            if (isNaN(num) || num === null) return '$0';
            return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', maximumFractionDigits: 0 }).format(num);
        };

        const showSaveIndicator = () => {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.remove('opacity-0');
            setTimeout(() => {
                indicator.classList.add('opacity-0');
            }, 1500);
        };

        // --- 3. GESTI√ìN DE DATOS (Storage) ---

        function saveData(event) {
            const target = event.target || event;
            if (target.id) {
                localStorage.setItem(target.id, target.value);
                showSaveIndicator();
            }
        }

        function loadAllData() {
            // Load app data
            staticIdsToSave.forEach(id => {
                const element = document.getElementById(id);
                const savedVal = localStorage.getItem(id);
                if (element && savedVal) element.value = savedVal;
            });
            
            const savedDays = localStorage.getItem('selectedDaysStorage');
            if (savedDays) {
                selectedDays = JSON.parse(savedDays);
            } else {
                selectedDays = [1, 2, 3, 4, 5]; 
                localStorage.setItem('selectedDaysStorage', JSON.stringify(selectedDays));
            }
            updateDayButtonsVisuals();
            
            const savedServiceName = localStorage.getItem('serviceName');
            if(savedServiceName) {
                serviceName = savedServiceName;
                const options = document.getElementById('servicioSelector').options;
                for(let i=0; i<options.length; i++) {
                    if(options[i].getAttribute('data-name') === serviceName) {
                        document.getElementById('servicioSelector').selectedIndex = i;
                        break;
                    }
                }
            }

            // Load Calc Data
            const savedDenoms = localStorage.getItem('calc-denoms');
            if(savedDenoms) calcDenominations = JSON.parse(savedDenoms);
            
            // Initial Calc
            const metaVal = parseFloat(document.getElementById('metaLiquida').value);
            const precioRefVal = parseFloat(document.getElementById('precioReferencia').value);

            if (metaVal > 0 && precioRefVal > 0 && selectedDays.length > 0) {
                performCalculation();
            }
        }
        
        function saveSelectedDays() {
            localStorage.setItem('selectedDaysStorage', JSON.stringify(selectedDays));
            showSaveIndicator();
        }

        function updateDayButtonsVisuals() {
            const buttons = document.querySelectorAll('.day-btn');
            buttons.forEach(btn => {
                const dayIndex = parseInt(btn.getAttribute('data-day'));
                if (selectedDays.includes(dayIndex)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        function updateServiceLabels() {
            const labels = [
                document.getElementById('lblServicioMeta'),
                document.getElementById('lblServicioFaltante'),
                document.getElementById('lblServicioPromedio')
            ];
            
            labels.forEach(lbl => {
                if(lbl) lbl.textContent = serviceName;
            });
        }

        // --- 4. CALCULADORA LOGIC ---

        function openCalculator(targetInputId) {
            currentCalcInputId = targetInputId;
            // Reset counts for fresh calculation or load saved? Let's reset for daily count logic.
            calcCounts = {}; 
            calcDenominations.forEach(d => calcCounts[d] = 0);
            
            renderCalcGrid();
            updateCalcTotal();
            
            document.getElementById('calculatorModal').classList.add('open');
            triggerHaptic();
        }

        function closeCalculator() {
            document.getElementById('calculatorModal').classList.remove('open');
            currentCalcInputId = null;
        }

        function applyCalculatorTotal() {
            if(currentCalcInputId) {
                const total = calcDenominations.reduce((acc, val) => acc + (val * (calcCounts[val] || 0)), 0);
                const input = document.getElementById(currentCalcInputId);
                if(input) {
                    input.value = total;
                    input.dispatchEvent(new Event('input')); // Trigger save & update logic
                }
            }
            closeCalculator();
            triggerHaptic();
        }

        function triggerHaptic() {
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function updateCalcTotal() {
            const total = calcDenominations.reduce((acc, val) => acc + (val * (calcCounts[val] || 0)), 0);
            document.getElementById('calcTotalDisplay').textContent = formatCurrency(total);
        }

        function toggleAddDenom() {
            document.getElementById('addDenomContainer').classList.toggle('hidden');
        }

        function calcAddNew() {
            const input = document.getElementById('newDenomInput');
            const val = parseInt(input.value);
            if(val > 0 && !calcDenominations.includes(val)) {
                calcDenominations.push(val);
                calcDenominations.sort((a, b) => b - a); // Descending
                localStorage.setItem('calc-denoms', JSON.stringify(calcDenominations));
                calcCounts[val] = 0;
                renderCalcGrid();
                input.value = '';
                toggleAddDenom();
            }
        }

        function calcReset() {
            if(confirm('¬øBorrar conteo?')) {
                calcDenominations.forEach(d => calcCounts[d] = 0);
                renderCalcGrid();
                updateCalcTotal();
                triggerHaptic();
            }
        }

        function calcDeleteDenom(val) {
            if(confirm(`¬øEliminar bot√≥n de $${val}?`)) {
                calcDenominations = calcDenominations.filter(d => d !== val);
                localStorage.setItem('calc-denoms', JSON.stringify(calcDenominations));
                renderCalcGrid();
                updateCalcTotal();
            }
        }

        function calcChange(val, delta) {
            const current = calcCounts[val] || 0;
            const next = current + delta;
            if(next >= 0) {
                calcCounts[val] = next;
                // Update badge and subtotal specifically to avoid full re-render
                const card = document.getElementById(`card-${val}`);
                if(card) {
                    const badge = card.querySelector('.count-badge');
                    const subtotal = card.querySelector('.subtotal-display');
                    
                    badge.textContent = next;
                    badge.className = `count-badge px-2 py-0.5 rounded-full text-xs font-bold transition-all border ${next > 0 ? 'bg-cyan-500/20 text-cyan-300 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.2)]' : 'bg-white/5 text-white/30 border-white/5'}`;
                    
                    subtotal.textContent = next > 0 ? formatCurrency(val * next) : '';
                }
                updateCalcTotal();
                triggerHaptic();
            }
        }

        function renderCalcGrid() {
            const grid = document.getElementById('calcGrid');
            grid.innerHTML = '';

            calcDenominations.forEach(val => {
                const count = calcCounts[val] || 0;
                
                const card = document.createElement('div');
                card.id = `card-${val}`;
                card.className = "calc-card relative h-24 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 shadow-lg overflow-hidden select-none active:scale-[0.98]";
                
                // Delete button
                const delBtn = document.createElement('button');
                delBtn.className = "absolute top-1 right-1 z-30 p-1 text-white/20 hover:text-rose-400 rounded-full transition-all";
                delBtn.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6L6 18M6 6l12 12"/></svg>';
                delBtn.onclick = (e) => { e.stopPropagation(); calcDeleteDenom(val); };
                
                // Touch Areas
                const touchArea = document.createElement('div');
                touchArea.className = "absolute inset-0 flex h-full w-full z-10";
                
                const leftBtn = document.createElement('button');
                leftBtn.className = "w-1/2 h-full flex items-center justify-start pl-3 active:bg-rose-500/10 transition-colors outline-none";
                leftBtn.onclick = () => calcChange(val, -1);
                leftBtn.innerHTML = `<div class="bg-rose-500/10 border border-rose-500/30 text-rose-400 p-1 rounded-full opacity-40"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14"/></svg></div>`;

                const rightBtn = document.createElement('button');
                rightBtn.className = "w-1/2 h-full flex items-center justify-end pr-3 active:bg-emerald-500/10 transition-colors outline-none";
                rightBtn.onclick = () => calcChange(val, 1);
                rightBtn.innerHTML = `<div class="bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 p-1 rounded-full opacity-40"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 5v14M5 12h14"/></svg></div>`;

                touchArea.appendChild(leftBtn);
                touchArea.appendChild(rightBtn);

                // Info Center
                const info = document.createElement('div');
                info.className = "absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-0";
                
                const valText = document.createElement('span');
                valText.className = "text-xl font-bold text-white tracking-wide drop-shadow-md";
                valText.textContent = val.toLocaleString();

                const badge = document.createElement('div');
                badge.className = `count-badge px-2 py-0.5 rounded-full text-xs font-bold transition-all border ${count > 0 ? 'bg-cyan-500/20 text-cyan-300 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.2)]' : 'bg-white/5 text-white/30 border-white/5'}`;
                badge.textContent = count;

                const subtotal = document.createElement('span');
                subtotal.className = "subtotal-display text-[10px] text-cyan-200/70 font-medium mt-1 tracking-wider min-h-[15px]";
                subtotal.textContent = count > 0 ? formatCurrency(val * count) : '';

                info.appendChild(valText);
                info.appendChild(badge);
                info.appendChild(subtotal);

                card.appendChild(delBtn);
                card.appendChild(touchArea);
                card.appendChild(info);
                
                grid.appendChild(card);
            });
        }

        // --- 4. INTERFAZ DIN√ÅMICA ---

        function generarInputsDias() {
            const container = document.getElementById('inputsDiasContainer');
            container.innerHTML = ''; 
            
            const sortedDays = [...selectedDays].sort((a, b) => a - b);

            if (sortedDays.length === 0) return;

            sortedDays.forEach(dayIndex => {
                const dayName = daysNames[dayIndex];
                const inputId = `dia_${dayName}`; 
                
                // Contenedor principal de la fila
                const wrapper = document.createElement('div');
                wrapper.className = 'flex flex-col space-y-1';
                
                const label = document.createElement('label');
                label.setAttribute('for', inputId);
                label.className = 'block text-xs font-bold text-white/60 ml-1';
                label.textContent = dayName.toUpperCase();
                
                // Contenedor Input + Botones + Calculadora
                const controlsContainer = document.createElement('div');
                controlsContainer.className = 'flex items-center gap-2';

                // Bot√≥n Calculadora
                const btnCalc = document.createElement('button');
                btnCalc.className = 'control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold bg-indigo-500/20 border-indigo-500/30 text-indigo-300 hover:bg-indigo-500/40 hover:text-white transition-all shadow-[0_0_10px_rgba(99,102,241,0.1)]';
                btnCalc.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>';
                btnCalc.onclick = () => openCalculator(inputId);

                // Bot√≥n Menos
                const btnMinus = document.createElement('button');
                btnMinus.className = 'control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold';
                btnMinus.innerHTML = '&minus;';
                
                // Bot√≥n M√°s
                const btnPlus = document.createElement('button');
                btnPlus.className = 'control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold';
                btnPlus.innerHTML = '&plus;';
                
                // Input
                const inputContainer = document.createElement('div');
                inputContainer.className = 'relative flex-1';
                
                const symbol = document.createElement('span');
                symbol.className = 'absolute left-3 top-1/2 -translate-y-1/2 text-white/40';
                symbol.textContent = '$';

                const input = document.createElement('input');
                input.type = 'number';
                input.id = inputId;
                input.className = 'dia-input glass-input w-full rounded-xl pl-7 p-3 outline-none font-bold text-center transition-all';
                input.placeholder = "0";
                
                const savedVal = localStorage.getItem(inputId);
                if (savedVal) {
                    input.value = savedVal;
                }

                input.addEventListener('input', (e) => {
                    saveData(e);
                    actualizarSeguimiento();
                });
                
                // Asignar l√≥gica de Long Press a los botones
                setupLongPress(btnMinus, input, -500);
                setupLongPress(btnPlus, input, 500);

                inputContainer.appendChild(symbol);
                inputContainer.appendChild(input);
                
                controlsContainer.appendChild(btnCalc); // Icono calculadora primero
                controlsContainer.appendChild(btnMinus);
                controlsContainer.appendChild(inputContainer);
                controlsContainer.appendChild(btnPlus);

                wrapper.appendChild(label);
                wrapper.appendChild(controlsContainer);
                container.appendChild(wrapper);
            });
        }
        
        // --- L√≥gica de Long Press (Mantener presionado) ---
        function setupLongPress(button, input, step) {
            let interval;
            let timeout;
            
            const modifyValue = () => {
                let current = parseFloat(input.value) || 0;
                current += step;
                if(current < 0) current = 0;
                input.value = current;
                // Disparar eventos manualmente
                input.dispatchEvent(new Event('input'));
            };

            const start = (e) => {
                if(e.type === 'touchstart') e.preventDefault();
                
                modifyValue(); 
                
                timeout = setTimeout(() => {
                    // Carga r√°pida (Turbo) - 40ms
                    interval = setInterval(modifyValue, 40); 
                }, 300); 
            };

            const stop = () => {
                clearTimeout(timeout);
                clearInterval(interval);
            };

            // Eventos Mouse
            button.addEventListener('mousedown', start);
            button.addEventListener('mouseup', stop);
            button.addEventListener('mouseleave', stop);
            
            // Eventos Touch (M√≥vil)
            button.addEventListener('touchstart', start);
            button.addEventListener('touchend', stop);
            button.addEventListener('touchcancel', stop);
        }

        // --- 5. L√ìGICA DE C√ÅLCULO ---

        function performCalculation() {
            const precioRef = parseFloat(document.getElementById('precioReferencia').value) || 0;
            const metaLiquida = parseFloat(document.getElementById('metaLiquida').value) || 0;
            const countDias = selectedDays.length;
            
            const errorDiv = document.getElementById('error');
            const resultadoDiv = document.getElementById('resultado');
            const seguimientoDiv = document.getElementById('seguimiento');

            if (metaLiquida <= 0 || precioRef <= 0 || countDias <= 0) {
                return;
            }

            errorDiv.classList.add('hidden');

            metaLiquidaGoal = metaLiquida;
            precioCorteGoal = precioRef; 
            diasTrabajoGoal = countDias;

            const totalFacturar = metaLiquida / tuPorcentaje;
            const comisionMonto = totalFacturar * comisionPorcentaje;
            const metaDiariaFacturar = totalFacturar / diasTrabajoGoal;
            
            const cortesPorDia = Math.ceil(metaDiariaFacturar / precioCorteGoal); 

            const facturacionDiariaAprox = cortesPorDia * precioCorteGoal;
            const facturacionSemanalAprox = facturacionDiariaAprox * diasTrabajoGoal;
            const gananciaLiquidaAprox = facturacionSemanalAprox * tuPorcentaje;
            
            const diferencia = gananciaLiquidaAprox - metaLiquida;

            document.getElementById('resMetaLiquida').textContent = formatCurrency(metaLiquida);
            document.getElementById('resTotalFacturar').textContent = formatCurrency(totalFacturar);
            document.getElementById('resComision').textContent = formatCurrency(comisionMonto);
            document.getElementById('resMetaDiaria').textContent = formatCurrency(metaDiariaFacturar);
            document.getElementById('resCortesPorDia').textContent = cortesPorDia;

            document.getElementById('resGananciaProyectada').textContent = formatCurrency(gananciaLiquidaAprox);
            
            const diffEl = document.getElementById('resDiferenciaGanancia');
            if(diferencia > 0) {
                diffEl.textContent = `+ ${formatCurrency(diferencia)} extra`;
                diffEl.classList.remove('hidden');
            } else {
                diffEl.textContent = 'Exacto';
            }
            
            updateServiceLabels();

            resultadoDiv.classList.remove('hidden');
            seguimientoDiv.classList.remove('hidden');
            
            generarInputsDias(); 
            actualizarSeguimiento();
        }

        function actualizarSeguimiento() {
            metaLiquidaGoal = parseFloat(document.getElementById('metaLiquida').value) || 0;
            precioCorteGoal = parseFloat(document.getElementById('precioReferencia').value) || 0;
            diasTrabajoGoal = selectedDays.length;

            const diasInputs = document.querySelectorAll('.dia-input');
            let totalFacturadoReal = 0;
            let diasCargados = 0;

            diasInputs.forEach(input => {
                const val = parseFloat(input.value) || 0;
                totalFacturadoReal += val;
                if (val > 0) diasCargados++;
            });

            const gananciaLiquidaReal = totalFacturadoReal * tuPorcentaje;
            const faltante = metaLiquidaGoal - gananciaLiquidaReal;

            document.getElementById('resTotalReal').textContent = formatCurrency(totalFacturadoReal);
            document.getElementById('resGananciaReal').textContent = formatCurrency(gananciaLiquidaReal);

            const faltanteWrapper = document.getElementById('resFaltanteWrapper');
            const exitoDiv = document.getElementById('mensajeExito');
            const cortesWrapper = document.getElementById('cortesFaltantesWrapper');
            const cortesSpan = document.getElementById('resCortesFaltantes');
            const promedioWrapper = document.getElementById('promedioFaltanteWrapper');
            const promedioSpan = document.getElementById('resPromedioFaltante');
            const promedioCortesSpan = document.getElementById('resPromedioCortes');
            
            updateServiceLabels();

            if (faltante > 100) { 
                exitoDiv.classList.add('hidden'); 
                faltanteWrapper.classList.remove('hidden');
                
                document.getElementById('resFaltante').textContent = formatCurrency(faltante);

                if (precioCorteGoal > 0) {
                    const faltanteBruto = faltante / tuPorcentaje;
                    const cortesFaltantes = Math.ceil(faltanteBruto / precioCorteGoal);
                    cortesSpan.textContent = cortesFaltantes;
                    cortesWrapper.classList.remove('hidden');
                } else {
                    cortesWrapper.classList.add('hidden');
                }

                let diasRestantesCalculo = diasTrabajoGoal - diasCargados;
                if (diasRestantesCalculo <= 0) diasRestantesCalculo = 0;

                if (diasRestantesCalculo > 0) {
                    const faltanteBruto = faltante / tuPorcentaje; 
                    const metaDiariaRestanteBruta = faltanteBruto / diasRestantesCalculo;
                    const serviciosDiariosRestantes = Math.ceil(metaDiariaRestanteBruta / precioCorteGoal);
                    
                    promedioSpan.textContent = formatCurrency(metaDiariaRestanteBruta);
                    if(promedioCortesSpan) promedioCortesSpan.textContent = serviciosDiariosRestantes;
                    
                    promedioWrapper.classList.remove('hidden');
                } else {
                    promedioWrapper.classList.add('hidden');
                }

            } else {
                faltanteWrapper.classList.add('hidden');
                exitoDiv.classList.remove('hidden');
                const extra = gananciaLiquidaReal - metaLiquidaGoal;
                document.getElementById('resExtra').textContent = formatCurrency(Math.max(0, extra));
            }
        }

        // --- 6. EVENTOS ---
        
        document.getElementById('servicioSelector').addEventListener('change', function() {
            const precio = this.value;
            const input = document.getElementById('precioReferencia');
            input.value = precio;
            
            const selectedOption = this.options[this.selectedIndex];
            serviceName = selectedOption.getAttribute('data-name') || 'Cortes';
            localStorage.setItem('serviceName', serviceName);
            
            input.dispatchEvent(new Event('input'));
            
            if(document.getElementById('metaLiquida').value) {
                performCalculation();
            }
        });

        document.querySelectorAll('.save-input').forEach(input => {
            input.addEventListener('input', saveData);
        });

        document.querySelectorAll('.day-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const dayIndex = parseInt(this.getAttribute('data-day'));
                if (selectedDays.includes(dayIndex)) {
                    selectedDays = selectedDays.filter(d => d !== dayIndex);
                } else {
                    selectedDays.push(dayIndex);
                }
                saveSelectedDays();
                updateDayButtonsVisuals();
            });
        });

        document.getElementById('calcularBtn').addEventListener('click', function() {
            if (selectedDays.length === 0) {
                document.getElementById('error').classList.remove('hidden');
                return;
            }
            performCalculation();
            document.getElementById('resultado').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        document.getElementById('resetBtn').addEventListener('click', function() {
            if(!confirm("¬øEmpezar semana nueva? Se borrar√° la meta y los montos diarios.")) return;

            localStorage.removeItem('metaLiquida');
            const metaInput = document.getElementById('metaLiquida');
            if(metaInput) metaInput.value = '';

            daysNames.forEach(day => {
                localStorage.removeItem(`dia_${day}`);
            });
            
            const inputsDias = document.querySelectorAll('.dia-input');
            inputsDias.forEach(input => input.value = '');

            metaLiquidaGoal = 0;
            
            document.getElementById('resultado').classList.add('hidden');
            document.getElementById('seguimiento').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
        });

        document.getElementById('toggleGuia').addEventListener('change', function() {
            const contenido = document.getElementById('contenidoGuia');
            if (this.checked) {
                contenido.style.maxHeight = contenido.scrollHeight + "px";
            } else {
                contenido.style.maxHeight = "0px";
            }
        });

        // --- 7. INICIALIZACI√ìN ---
        loadAllData();

    </script>
</body>
</html>


