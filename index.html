<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarberApp - Gesti√≥n Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }
        .glass-input:focus {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        select.glass-input option {
            background-color: #1f2937;
            color: white;
        }

        .day-btn { transition: all 0.2s ease; }
        .day-btn.active {
            background: white;
            color: #e73c7e;
            font-weight: 800;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.1s;
            user-select: none;
            touch-action: manipulation;
        }
        .control-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);
            z-index: 50; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        
        /* Z-INDEX PARA CALCULADORA ENCIMA DE TODO */
        #calculatorModal { z-index: 100; }
        #dialogModal { z-index: 200; }

        .chart-point:hover { cursor: pointer; transform: scale(1.5); transform-origin: center; transition: transform 0.2s; }

        /* Estilos Calendario Manual */
        .calendar-day {
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            border-radius: 8px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s;
            color: rgba(255,255,255,0.7);
        }
        .calendar-day:hover { background: rgba(255,255,255,0.1); color: white; }
        .calendar-day.selected { font-weight: 800; color: #1a1b26; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
        .calendar-day.has-data { background: rgba(0, 0, 0, 0.6); color: #86efac; border: 1px solid rgba(255,255,255,0.1); }
        .week-indicator { font-size: 0.65rem; text-transform: uppercase; color: rgba(255,255,255,0.3); text-align: center; margin-bottom: 4px; }
        .manual-week-btn { position: relative; overflow: hidden; }
        .manual-week-btn.filled { background-color: rgba(0, 0, 0, 0.6); color: #d1d5db; border: 1px solid rgba(255,255,255,0.2); }
        .manual-week-btn.filled::after { content: '‚úì'; position: absolute; top: 2px; right: 4px; font-size: 0.6rem; color: #4ade80; }

        /* Estilos EXPANDED CHART (Zoom) */
        .chart-zoom-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(15px);
            z-index: 60; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .chart-zoom-overlay.open { opacity: 1; pointer-events: auto; }
        
        .chart-zoom-card {
            width: 95%; max-width: 800px;
            height: auto; min-height: 50vh; max-height: 85vh;
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px; padding: 24px;
            transform: scale(0.9); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column;
            overflow: hidden; 
        }
        .chart-zoom-overlay.open .chart-zoom-card { transform: scale(1); }
        
        #chartContainer { cursor: zoom-in; }

        /* --- Estilos Calculadora Moderna Glass iOS --- */
        .calc-btn {
            appearance: none;
            outline: none;
            border: none;
            background: rgba(255, 255, 255, 0.15); /* Base glass */
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1.5rem;
            font-weight: 400;
            border-radius: 50%; /* C√≠rculo perfecto */
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s ease, background 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Efecto de pulsaci√≥n */
        .calc-btn:active {
            transform: scale(0.92);
            background: rgba(255, 255, 255, 0.3);
        }

        /* Botones de Operadores (Naranja Glass iOS) */
        .calc-btn.op {
            background: rgba(255, 159, 10, 0.85);
            border-color: rgba(255, 159, 10, 0.4);
            font-weight: 600;
            font-size: 1.75rem;
        }
        .calc-btn.op:active {
            background: rgba(255, 159, 10, 1);
        }

        /* Botones de Funci√≥n Superior (Gris Claro Glass) */
        .calc-btn.func {
            background: rgba(165, 165, 165, 0.4);
            color: #fff;
            font-weight: 500;
            font-size: 1.25rem;
        }
        
        /* Botones Num√©ricos (Gris Oscuro Glass) */
        .calc-btn.num {
            background: rgba(51, 51, 51, 0.5);
        }
        .calc-btn.num:hover {
            background: rgba(60, 60, 60, 0.6);
        }

        /* Bot√≥n Cero (Pastilla) */
        .calc-btn.zero {
            grid-column: span 2;
            aspect-ratio: auto;
            border-radius: 9999px; /* Pill shape */
            justify-content: flex-start;
            padding-left: 28px;
        }
    </style>
</head>
<body class="min-h-full p-4 md:p-8 text-white selection:bg-pink-500 selection:text-white">

    <div class="max-w-3xl mx-auto space-y-8 pb-16">
        
        <!-- Encabezado -->
        <header class="text-center space-y-2 pt-6">
            <h1 class="text-5xl font-black tracking-tight drop-shadow-md">Barber<span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-200">App</span></h1>
            <p class="text-white/80 font-medium">Gesti√≥n Financiera & Historial</p>
            <div id="saveIndicator" class="opacity-0 transition-opacity duration-300 text-xs font-bold text-white/90 bg-black/20 inline-flex items-center gap-1 px-3 py-1 rounded-full mt-2 backdrop-blur-sm">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                Guardado
            </div>
        </header>

        <!-- 1. Configuraci√≥n Principal -->
        <section class="glass-panel rounded-3xl p-6 md:p-8 space-y-8">
            <div class="flex items-center gap-3 border-b border-white/10 pb-4 mb-4">
                <span class="bg-white/20 w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">1</span>
                <h2 class="text-xl font-bold text-white">Configuraci√≥n</h2>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="space-y-3">
                    <label class="text-sm font-bold text-white/70 uppercase tracking-wider">Usar precio de referencia:</label>
                    <select id="servicioSelector" class="glass-input w-full rounded-xl p-3 font-medium outline-none cursor-pointer">
                        <option value="12000" data-name="Cortes" selected>Corte ($12.000)</option>
                        <option value="15000" data-name="Cortes + Barba">Corte + Barba ($15.000)</option>
                        <option value="8000" data-name="Barbas">Barba ($8.000)</option>
                        <option value="2000" data-name="Dise√±os">Dise√±os (desde $2.000)</option>
                    </select>
                    <div class="relative group">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 text-xl font-light">$</span>
                        <input type="number" id="precioReferencia" class="save-input glass-input w-full rounded-2xl pl-8 p-4 text-2xl font-bold outline-none transition-all placeholder-white/20" value="12000">
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="text-sm font-bold text-white/70 uppercase tracking-wider">Tu Ganancia Objetivo (55%)</label>
                    <div class="relative group">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/50 text-xl font-light">$</span>
                        <input type="number" id="metaLiquida" class="save-input glass-input w-full rounded-2xl pl-8 p-4 text-2xl font-bold outline-none transition-all placeholder-white/20" placeholder="Ej: 200000">
                    </div>
                </div>
            </div>

            <div class="space-y-4 pt-4">
                <label class="text-sm font-bold text-white/70 uppercase tracking-wider">D√≠as de Trabajo</label>
                <div class="flex flex-wrap justify-between gap-2" id="daySelectorContainer">
                    <button type="button" data-day="0" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">L</button>
                    <button type="button" data-day="1" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">M</button>
                    <button type="button" data-day="2" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">M</button>
                    <button type="button" data-day="3" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">J</button>
                    <button type="button" data-day="4" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">V</button>
                    <button type="button" data-day="5" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">S</button>
                    <button type="button" data-day="6" class="day-btn w-11 h-11 rounded-xl glass-input font-bold flex items-center justify-center hover:bg-white/10">D</button>
                </div>
            </div>

            <div class="pt-2">
                <button id="calcularBtn" class="w-full bg-white text-pink-600 hover:bg-white/90 font-extrabold py-4 px-6 rounded-2xl text-lg shadow-lg shadow-black/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                    Calcular Plan
                </button>
            </div>
        </section>

        <!-- Error Msg -->
        <div id="error" class="hidden fade-in bg-red-500/80 backdrop-blur-md border border-white/20 text-white p-4 rounded-2xl text-center font-bold shadow-lg">
            ‚ö†Ô∏è Ingres√° una Meta ($) y seleccion√° al menos un d√≠a para empezar.
        </div>

        <!-- 2. Tu Plan (Resultado) -->
        <section id="resultado" class="hidden fade-in space-y-6">
            <div class="glass-panel rounded-3xl p-8 text-center relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <h3 class="text-white/60 text-lg mb-2 font-medium">Objetivo Diario de Facturaci√≥n</h3>
                <p class="text-5xl md:text-6xl font-black text-white mb-6 drop-shadow-lg" id="resMetaDiaria">$0</p>
                <div class="inline-flex items-center gap-4 bg-black/20 p-2 pr-6 rounded-full border border-white/10 backdrop-blur-sm">
                    <div class="bg-white text-pink-600 w-12 h-12 rounded-full flex items-center justify-center font-black text-xl shadow-lg" id="resCortesPorDia">0</div>
                    <div class="text-left">
                        <p id="lblServicioMeta" class="text-sm text-white font-bold leading-none">Cortes</p>
                        <p class="text-xs text-white/60 leading-none mt-1">por d√≠a aprox.</p>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t border-white/10 text-sm">
                    <p class="text-white/80">*Si cumpl√≠s, tu ganancia real ser√°:</p>
                    <div class="flex items-center justify-center gap-2 mt-1">
                        <span id="resGananciaProyectada" class="text-2xl font-bold text-white">$0</span>
                        <span id="resDiferenciaGanancia" class="bg-green-500/20 text-green-300 px-2 py-0.5 rounded text-xs font-bold border border-green-500/30">+ $0 extra</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Seguimiento Diario -->
        <section id="seguimiento" class="hidden fade-in glass-panel rounded-3xl p-6 md:p-8">
            <div class="flex items-center gap-3 border-b border-white/10 pb-4 mb-6">
                <span class="bg-white/20 w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">2</span>
                <h2 class="text-xl font-bold text-white">Seguimiento Real</h2>
            </div>
            <div id="inputsDiasContainer" class="grid grid-cols-1 gap-6 mb-8"></div>
            <div class="bg-black/20 rounded-2xl p-6 border border-white/5 space-y-6 backdrop-blur-sm">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pb-6 border-b border-white/10">
                    <div class="text-center sm:text-left">
                        <p class="text-xs text-white/50 uppercase font-bold">Total Facturado</p>
                        <p class="text-3xl font-bold text-white" id="resTotalReal">$0</p>
                    </div>
                    <div class="text-center sm:text-right">
                        <p class="text-xs text-green-300 uppercase font-bold">Tu Ganancia L√≠quida</p>
                        <p class="text-3xl font-bold text-green-400 drop-shadow-sm" id="resGananciaReal">$0</p>
                    </div>
                </div>
                <div id="estadoMetaContainer">
                    <div id="resFaltanteWrapper" class="hidden text-center space-y-4">
                        <div>
                            <p class="text-sm text-white/70">Te falta para el objetivo (Ganancia):</p>
                            <p class="text-4xl font-bold text-white" id="resFaltante">$0</p>
                        </div>
                        <div id="cortesFaltantesWrapper" class="inline-block bg-white/10 px-6 py-2 rounded-full border border-white/10 backdrop-blur-md">
                            <span class="text-sm font-medium">Equivale a facturar <span id="resCortesFaltantes" class="font-bold text-xl mx-1 text-white">0</span> <span id="lblServicioFaltante">Cortes</span> m√°s</span>
                        </div>
                        <div id="promedioFaltanteWrapper" class="pt-2">
                             <p class="text-xs text-white/60">Necesit√°s <span class="text-white font-bold underline">facturar</span> <span id="resPromedioFaltante" class="text-white font-bold">$0</span> en cada d√≠a restante. <span id="resPromedioCortesWrapper" class="block mt-1 text-white/80">(aprox. <span id="resPromedioCortes" class="font-bold text-white">0</span> <span id="lblServicioPromedio">Cortes</span> diarios)</span></p>
                        </div>
                    </div>
                    <div id="mensajeExito" class="hidden text-center py-4">
                        <div class="inline-flex p-4 bg-green-500/20 rounded-full mb-4 border border-green-500/30 shadow-[0_0_20px_rgba(34,197,94,0.3)]">
                            <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h3 class="text-2xl font-black text-white mb-1">¬°META LOGRADA! üéâ</h3>
                        <p class="text-white/80">Extra generado: <span id="resExtra" class="font-bold text-white">$0</span></p>
                    </div>
                </div>
            </div>

            <!-- Bot√≥n Cerrar Semana -->
            <div class="mt-8 pt-4 border-t border-white/10">
                <button id="resetBtn" class="w-full sm:w-auto mx-auto block glass-input hover:bg-white/10 text-white font-bold py-4 px-8 rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-3 border border-white/20 hover:border-pink-500/50" title="Guardar en historial y limpiar">
                    <svg class="w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
                    Cerrar Semana Actual
                </button>
            </div>
        </section>

        <!-- 4. HISTORIAL Y GR√ÅFICOS -->
        <section id="historySection" class="glass-panel rounded-3xl p-6 md:p-8 space-y-6 select-none">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 border-b border-white/10 pb-4">
                <div class="flex items-center gap-3">
                    <span class="bg-white/20 w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">3</span>
                    <h2 class="text-xl font-bold text-white">Evoluci√≥n Mensual</h2>
                </div>
                
                <div class="flex items-center gap-3">
                    <button onclick="openManualModal()" class="px-3 py-2 bg-indigo-500/20 border border-indigo-500/50 hover:bg-indigo-500/40 text-indigo-200 rounded-xl text-xs font-bold flex items-center gap-1 transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                        Manual
                    </button>

                    <div class="flex items-center gap-2 bg-black/20 px-3 py-2 rounded-xl">
                        <button onclick="changeMonth(-1)" class="text-white/50 hover:text-white transition-colors p-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button>
                        <span id="currentMonthDisplay" class="font-bold text-white uppercase tracking-wider text-sm min-w-[110px] text-center">ENERO 2024</span>
                        <button onclick="changeMonth(1)" class="text-white/50 hover:text-white transition-colors p-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                    </div>
                </div>
            </div>

            <div onclick="expandChart()" class="relative h-72 w-full bg-black/10 rounded-2xl border border-white/5 p-4 flex flex-col justify-end group overflow-hidden transition-all hover:bg-black/20 hover:border-white/10 cursor-zoom-in" id="mainChartWrapper">
                <div class="absolute top-4 right-4 bg-white/10 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg>
                </div>
                
                <div id="chartContainer" class="w-full h-full relative">
                    <p class="absolute inset-0 flex items-center justify-center text-white/20 text-sm">No hay registros guardados en este mes.<br><span class="text-xs opacity-50">(Desliz√° para ver otros meses)</span></p>
                </div>
                <!-- Fixed labels to align with data points -->
                <div class="absolute bottom-0 left-0 w-full px-2 pointer-events-none">
                    <div class="flex w-full text-[10px] text-white/40 uppercase tracking-widest pb-1">
                        <span class="w-1/4 text-center">Sem 1</span>
                        <span class="w-1/4 text-center">Sem 2</span>
                        <span class="w-1/4 text-center">Sem 3</span>
                        <span class="w-1/4 text-center">Sem 4</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white/5 p-4 rounded-2xl border border-white/5 text-center">
                    <p class="text-xs text-green-300 uppercase font-bold tracking-wider mb-1">Tu Ganancia Mensual</p>
                    <p id="monthUserTotal" class="text-2xl font-bold text-green-400">$0</p>
                </div>
                <div class="bg-white/5 p-4 rounded-2xl border border-white/5 text-center">
                    <p class="text-xs text-white/50 uppercase font-bold tracking-wider mb-1">A la Barber√≠a</p>
                    <p id="monthCompanyTotal" class="text-2xl font-bold text-white">$0</p>
                </div>
            </div>
        </section>

        <!-- 5. ACUMULADO ANUAL -->
        <section class="bg-black/40 border border-white/10 rounded-3xl p-6 md:p-8 backdrop-blur-md">
            <h2 class="text-lg font-bold text-white mb-6 flex items-center gap-2 opacity-80">
                <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Acumulado Anual (Total Hist√≥rico)
            </h2>
            <div class="flex flex-col md:flex-row gap-6 justify-around items-center">
                <div class="text-center w-full">
                    <p class="text-sm text-white/40 mb-2 uppercase tracking-widest">Total Generado (Bruto)</p>
                    <p id="yearTotalBruto" class="text-4xl font-black text-white">$0</p>
                </div>
                <div class="h-px w-full md:w-px md:h-20 bg-white/10"></div>
                <div class="text-center w-full">
                    <p class="text-sm text-green-400/60 mb-2 uppercase tracking-widest">Tu Bolsillo</p>
                    <p id="yearTotalUser" class="text-4xl font-black text-green-400">$0</p>
                </div>
                <div class="h-px w-full md:w-px md:h-20 bg-white/10"></div>
                <div class="text-center w-full">
                    <p class="text-sm text-white/40 mb-2 uppercase tracking-widest">Empresa</p>
                    <p id="yearTotalCompany" class="text-4xl font-black text-white/60">$0</p>
                </div>
            </div>
        </section>

        <p class="text-center text-white/30 text-xs mt-8 font-medium">Tus datos se guardan en este dispositivo.</p>
    </div>

    <!-- MODAL GR√ÅFICO EXPANDIDO -->
    <div id="chartZoomOverlay" class="chart-zoom-overlay">
        <div class="chart-zoom-card">
            <button onclick="closeExpandedChart()" class="absolute top-4 right-4 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 z-50">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <div class="text-center mb-4 pt-2 flex-shrink-0">
                <h2 id="expandedMonthDisplay" class="text-2xl font-bold text-white uppercase tracking-widest">ENERO 2024</h2>
                <p class="text-white/50 text-sm">Desliz√° para navegar</p>
            </div>
            <!-- Contenedor flexible para el gr√°fico, asegura espacio -->
            <div class="flex-1 w-full relative min-h-0" id="expandedChartContainer">
                <!-- Se clona el gr√°fico aqu√≠ -->
            </div>
            <!-- Etiquetas fijas alineadas -->
            <div class="flex justify-between w-full text-xs text-white/40 uppercase tracking-widest mt-4 px-2 flex-shrink-0">
                <span class="w-1/4 text-center">Semana 1</span>
                <span class="w-1/4 text-center">Semana 2</span>
                <span class="w-1/4 text-center">Semana 3</span>
                <span class="w-1/4 text-center">Semana 4</span>
            </div>
        </div>
    </div>

    <!-- MODAL CALCULADORA GLASS iOS -->
    <div id="calculatorModal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm rounded-[40px] overflow-hidden shadow-2xl backdrop-blur-xl border border-white/20">
            <div class="p-6 pb-2">
                <div class="text-right mb-4">
                    <div id="calcExpression" class="text-white/50 text-sm h-6 font-mono tracking-wide"></div>
                    <div id="calcDisplay" class="text-5xl font-light text-white font-sans tracking-tight leading-none">0</div>
                    <div class="flex justify-end items-center gap-2 mt-2">
                        <span class="text-[10px] text-green-400 font-bold uppercase tracking-wider bg-green-500/10 px-2 py-1 rounded">Tu Ganancia:</span>
                        <span id="calcProfitDisplay" class="text-sm font-bold text-green-400">$0</span>
                    </div>
                </div>
            </div>
            
            <div class="p-5 pb-8 grid grid-cols-4 gap-3 bg-black/10">
                <!-- Fila 1 -->
                <button onclick="calcInput('C')" class="calc-btn func">C</button>
                <button onclick="calcInput('DEL')" class="calc-btn func">‚å´</button>
                <button class="calc-btn func pointer-events-none opacity-50"></button> <!-- Spacer visual -->
                <button onclick="calcInput('/')" class="calc-btn op">√∑</button>
                
                <!-- Fila 2 -->
                <button onclick="calcInput('7')" class="calc-btn num">7</button>
                <button onclick="calcInput('8')" class="calc-btn num">8</button>
                <button onclick="calcInput('9')" class="calc-btn num">9</button>
                <button onclick="calcInput('*')" class="calc-btn op">√ó</button>
                
                <!-- Fila 3 -->
                <button onclick="calcInput('4')" class="calc-btn num">4</button>
                <button onclick="calcInput('5')" class="calc-btn num">5</button>
                <button onclick="calcInput('6')" class="calc-btn num">6</button>
                <button onclick="calcInput('-')" class="calc-btn op">‚àí</button>
                
                <!-- Fila 4 -->
                <button onclick="calcInput('1')" class="calc-btn num">1</button>
                <button onclick="calcInput('2')" class="calc-btn num">2</button>
                <button onclick="calcInput('3')" class="calc-btn num">3</button>
                <button onclick="calcInput('+')" class="calc-btn op">+</button>
                
                <!-- Fila 5 -->
                <button onclick="calcInput('0')" class="calc-btn num zero">0</button>
                <button onclick="calcInput('.')" class="calc-btn num">.</button>
                <button onclick="calcInput('=')" class="calc-btn op">=</button>
            </div>
            
            <div class="px-5 pb-6 flex justify-between gap-3">
                <button onclick="closeCalculator()" class="flex-1 py-3.5 rounded-2xl font-bold text-white/70 hover:bg-white/10 transition-colors text-sm">Cancelar</button>
                <button onclick="applyCalculatorResult()" class="flex-1 py-3.5 rounded-2xl font-bold bg-white text-black hover:bg-gray-100 shadow-lg active:scale-95 transition-transform text-sm">Aplicar Valor</button>
            </div>
        </div>
    </div>
    
    <!-- MODAL DI√ÅLOGO (REEMPLAZO DE ALERT/CONFIRM) -->
    <div id="dialogModal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm mx-4 rounded-3xl p-6 text-center transform scale-95 transition-transform duration-200" id="dialogContent">
            <h3 id="dialogTitle" class="text-xl font-bold text-white mb-2">Atenci√≥n</h3>
            <p id="dialogMsg" class="text-white/80 mb-6 text-sm"></p>
            <div class="flex gap-3 justify-center" id="dialogActions">
                <!-- Buttons injected by JS -->
            </div>
        </div>
    </div>

    <!-- MODAL MANUAL ENTRY (CALENDARIO) -->
    <div id="manualModal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm mx-4 rounded-3xl p-6 relative">
            <button onclick="closeManualModal()" class="absolute top-4 right-4 text-white/50 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            <h3 class="text-xl font-bold text-white mb-4">Carga Manual Hist√≥rica</h3>
            <p class="text-xs text-white/50 mb-6">Seleccion√° un mes y la semana a cargar/modificar.</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-white/60 mb-2 ml-1 uppercase">Mes & A√±o</label>
                    <div class="flex gap-2">
                        <select id="manualMonth" class="glass-input w-2/3 rounded-xl p-3 outline-none cursor-pointer text-sm"></select>
                        <select id="manualYear" class="glass-input w-1/3 rounded-xl p-3 outline-none cursor-pointer text-sm"></select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-white/60 mb-2 ml-1 uppercase">Seleccionar Semana</label>
                    <div class="glass-input rounded-xl p-3">
                        <div class="grid grid-cols-7 mb-2">
                            <div class="week-indicator">Lun</div><div class="week-indicator">Mar</div><div class="week-indicator">Mi√©</div><div class="week-indicator">Jue</div><div class="week-indicator">Vie</div><div class="week-indicator">S√°b</div><div class="week-indicator">Dom</div>
                        </div>
                        <div id="manualCalendarContainer" class="grid grid-cols-7 gap-1"></div>
                    </div>
                    <div class="grid grid-cols-5 gap-2 mt-4">
                        <button onclick="selectManualWeekFromButton(1)" class="manual-week-btn w-full h-10 rounded-lg glass-input hover:bg-white/20 font-bold" data-wk="1">1</button>
                        <button onclick="selectManualWeekFromButton(2)" class="manual-week-btn w-full h-10 rounded-lg glass-input hover:bg-white/20 font-bold" data-wk="2">2</button>
                        <button onclick="selectManualWeekFromButton(3)" class="manual-week-btn w-full h-10 rounded-lg glass-input hover:bg-white/20 font-bold" data-wk="3">3</button>
                        <button onclick="selectManualWeekFromButton(4)" class="manual-week-btn w-full h-10 rounded-lg glass-input hover:bg-white/20 font-bold" data-wk="4">4</button>
                        <button onclick="selectManualWeekFromButton(5)" class="manual-week-btn w-full h-10 rounded-lg glass-input hover:bg-white/20 font-bold" data-wk="5">5</button>
                    </div>
                    <p id="selectedWeekDisplay" class="text-center text-sm font-bold text-white mt-2 h-5"></p>
                    <input type="hidden" id="manualWeekSelect">
                </div>
                <div>
                    <label class="block text-xs font-bold text-white/60 mb-1 ml-1 uppercase text-emerald-400">Tu Ganancia (Lo que te llev√°s) ($)</label>
                    <div class="flex items-center gap-2">
                        <!-- NUEVO BOT√ìN CALCULADORA AQU√ç -->
                        <button onclick="openCalculator('manualAmount')" class="control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold bg-indigo-500/20 border-indigo-500/30 text-indigo-300 hover:bg-indigo-500/40 hover:text-white transition-all shadow-[0_0_10px_rgba(99,102,241,0.1)] flex-shrink-0">
                             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
                        </button>
                        <input type="number" id="manualAmount" class="glass-input w-full rounded-xl p-3 font-bold text-lg" placeholder="0">
                    </div>
                    <p class="text-[10px] text-white/40 mt-1">El sistema calcular√° el total facturado autom√°ticamente.</p>
                </div>
                <button id="btnSaveManual" onclick="saveManualEntry()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl mt-4 shadow-lg active:scale-95 transition-all">Guardar Registro</button>
            </div>
        </div>
    </div>

    <!-- L√ìGICA -->
    <script>
        // CONFIGURACI√ìN Y VARIABLES
        let metaLiquidaGoal = 0;
        let precioCorteGoal = 0;
        let diasTrabajoGoal = 0;
        let serviceName = 'Cortes'; 
        const tuPorcentaje = 0.55; 
        const comisionPorcentaje = 0.45; 
        
        const daysNames = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
        let selectedDays = []; 
        const staticIdsToSave = ['precioReferencia', 'metaLiquida'];

        let historyData = []; 
        let currentViewDate = new Date();
        const monthColors = ['#22d3ee', '#f472b6', '#4ade80', '#fbbf24', '#a78bfa', '#fb7185', '#60a5fa', '#f87171', '#34d399', '#818cf8', '#facc15', '#2dd4bf'];

        // VARIABLES CALCULADORA STANDARD
        let calcExpression = '';
        let calcResult = 0;
        let currentCalcInputId = null;
        let isChartExpanded = false;

        // FUNCIONES UTILITARIAS
        const formatCurrency = (num) => {
            if (isNaN(num) || num === null) return '$0';
            return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', maximumFractionDigits: 0 }).format(num);
        };

        const showSaveIndicator = () => {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.remove('opacity-0');
            setTimeout(() => { indicator.classList.add('opacity-0'); }, 1500);
        };
        
        // --- SISTEMA DE DI√ÅLOGO PERSONALIZADO (NO-ALERT) ---
        function showDialog(title, msg, onConfirm, onCancel, confirmText = "Aceptar", cancelText = "Cancelar") {
            const modal = document.getElementById('dialogModal');
            const content = document.getElementById('dialogContent');
            const titleEl = document.getElementById('dialogTitle');
            const msgEl = document.getElementById('dialogMsg');
            const actionsEl = document.getElementById('dialogActions');
            
            titleEl.textContent = title;
            msgEl.textContent = msg;
            actionsEl.innerHTML = '';

            // Cancel Button (if onCancel exists or simple alert)
            if (onCancel || !onConfirm) { // If it's a confirm or just a notification
                const btnCancel = document.createElement('button');
                btnCancel.className = "px-6 py-2 rounded-xl text-white/70 hover:bg-white/10 font-medium transition-colors border border-transparent";
                btnCancel.textContent = onConfirm ? cancelText : "Cerrar";
                btnCancel.onclick = () => {
                    modal.classList.remove('open');
                    setTimeout(() => { content.classList.remove('scale-100'); content.classList.add('scale-95'); }, 200);
                    if (onCancel) onCancel();
                };
                actionsEl.appendChild(btnCancel);
            }

            // Confirm Button (only if callback provided)
            if (onConfirm) {
                const btnConfirm = document.createElement('button');
                btnConfirm.className = "px-6 py-2 rounded-xl bg-white text-pink-600 font-bold hover:bg-gray-100 transition-colors shadow-lg";
                btnConfirm.textContent = confirmText;
                btnConfirm.onclick = () => {
                    modal.classList.remove('open');
                    setTimeout(() => { content.classList.remove('scale-100'); content.classList.add('scale-95'); }, 200);
                    onConfirm();
                };
                actionsEl.appendChild(btnConfirm);
            }
            
            modal.classList.add('open');
            setTimeout(() => { content.classList.remove('scale-95'); content.classList.add('scale-100'); }, 10);
        }

        // GESTI√ìN DE DATOS
        function saveData(event) {
            const target = event.target || event;
            if (target.id) {
                localStorage.setItem(target.id, target.value);
                showSaveIndicator();
            }
        }

        function loadAllData() {
            const savedHistory = localStorage.getItem('barber_history');
            if (savedHistory) historyData = JSON.parse(savedHistory);
            
            staticIdsToSave.forEach(id => {
                const element = document.getElementById(id);
                const savedVal = localStorage.getItem(id);
                if (element && savedVal) element.value = savedVal;
            });
            
            const savedDays = localStorage.getItem('selectedDaysStorage');
            if (savedDays) {
                selectedDays = JSON.parse(savedDays);
            } else {
                selectedDays = [1, 2, 3, 4, 5]; 
                localStorage.setItem('selectedDaysStorage', JSON.stringify(selectedDays));
            }
            updateDayButtonsVisuals();
            
            const savedServiceName = localStorage.getItem('serviceName');
            if(savedServiceName) {
                serviceName = savedServiceName;
                const options = document.getElementById('servicioSelector').options;
                for(let i=0; i<options.length; i++) {
                    if(options[i].getAttribute('data-name') === serviceName) {
                        document.getElementById('servicioSelector').selectedIndex = i;
                        break;
                    }
                }
            }
            
            renderHistorySection();
            setupSwipeGestures();

            const metaVal = parseFloat(document.getElementById('metaLiquida').value);
            const precioRefVal = parseFloat(document.getElementById('precioReferencia').value);

            if (metaVal > 0 && precioRefVal > 0 && selectedDays.length > 0) {
                performCalculation();
            }
        }
        
        function saveSelectedDays() {
            localStorage.setItem('selectedDaysStorage', JSON.stringify(selectedDays));
            showSaveIndicator();
        }

        function updateDayButtonsVisuals() {
            const buttons = document.querySelectorAll('.day-btn');
            buttons.forEach(btn => {
                const dayIndex = parseInt(btn.getAttribute('data-day'));
                if (selectedDays.includes(dayIndex)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        function updateServiceLabels() {
            const labels = [
                document.getElementById('lblServicioMeta'),
                document.getElementById('lblServicioFaltante'),
                document.getElementById('lblServicioPromedio')
            ];
            labels.forEach(lbl => { if(lbl) lbl.textContent = serviceName; });
        }

        // --- L√ìGICA DE HISTORIAL, GR√ÅFICOS Y SWIPE ---

        function changeMonth(delta) {
            currentViewDate.setMonth(currentViewDate.getMonth() + delta);
            renderHistorySection();
        }

        function setupSwipeGestures() {
            const targets = [document.getElementById('historySection'), document.getElementById('chartZoomOverlay')];
            targets.forEach(section => {
                let touchStartX = 0;
                let touchEndX = 0;
                section.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
                section.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); }, {passive: true});
                function handleSwipe() {
                    const threshold = 50; 
                    if (touchEndX < touchStartX - threshold) changeMonth(1); 
                    if (touchEndX > touchStartX + threshold) changeMonth(-1); 
                }
            });
        }

        function expandChart() {
            isChartExpanded = true;
            document.getElementById('chartZoomOverlay').classList.add('open');
            renderHistorySection(); 
        }

        function closeExpandedChart() {
            isChartExpanded = false;
            document.getElementById('chartZoomOverlay').classList.remove('open');
        }

        function renderHistorySection() {
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            const currentMonthIdx = currentViewDate.getMonth();
            const currentYear = currentViewDate.getFullYear();
            
            const displayText = `${monthNames[currentMonthIdx]} ${currentYear}`;
            document.getElementById('currentMonthDisplay').textContent = displayText;
            document.getElementById('expandedMonthDisplay').textContent = displayText; 

            const monthlyData = historyData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate.getFullYear() === currentYear && itemDate.getMonth() === currentMonthIdx;
            });

            const prevMonthDate = new Date(currentViewDate);
            prevMonthDate.setMonth(prevMonthDate.getMonth() - 1);
            const prevMonthIdx = prevMonthDate.getMonth();
            const prevYear = prevMonthDate.getFullYear();

            const prevMonthlyData = historyData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate.getFullYear() === prevYear && itemDate.getMonth() === prevMonthIdx;
            });

            renderChart(monthlyData, prevMonthlyData, currentMonthIdx, prevMonthIdx, document.getElementById('chartContainer'));
            renderChart(monthlyData, prevMonthlyData, currentMonthIdx, prevMonthIdx, document.getElementById('expandedChartContainer'));

            const monthBruto = monthlyData.reduce((acc, curr) => acc + curr.totalBruto, 0);
            const monthUser = monthBruto * tuPorcentaje;
            const monthCompany = monthBruto * comisionPorcentaje;

            document.getElementById('monthUserTotal').textContent = formatCurrency(monthUser);
            document.getElementById('monthCompanyTotal').textContent = formatCurrency(monthCompany);

            const yearBruto = historyData.reduce((acc, curr) => acc + curr.totalBruto, 0);
            const yearUser = yearBruto * tuPorcentaje;
            const yearCompany = yearBruto * comisionPorcentaje;

            document.getElementById('yearTotalBruto').textContent = formatCurrency(yearBruto);
            document.getElementById('yearTotalUser').textContent = formatCurrency(yearUser);
            document.getElementById('yearTotalCompany').textContent = formatCurrency(yearCompany);
        }

        function renderChart(currentData, prevData, currentMonthIdx, prevMonthIdx, container) {
            container.innerHTML = '';

            if (currentData.length === 0 && prevData.length === 0) {
                container.innerHTML = '<p class="absolute inset-0 flex items-center justify-center text-white/20 text-sm">No hay registros.<br><span class="text-xs opacity-50">Desliz√° para ver m√°s.</span></p>';
                return;
            }

            const maxValCurrent = Math.max(...currentData.map(d => d.netUser), 0);
            const maxValPrev = Math.max(...prevData.map(d => d.netUser), 0);
            const maxVal = Math.max(maxValCurrent, maxValPrev) || 1;

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", `0 0 100 100`);
            svg.setAttribute("preserveAspectRatio", "none");
            svg.style.overflow = 'visible';

            const gridLines = [0, 25, 50, 75, 100];
            gridLines.forEach(y => {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", "0"); line.setAttribute("y1", y);
                line.setAttribute("x2", "100"); line.setAttribute("y2", y);
                line.setAttribute("stroke", "rgba(255,255,255,0.05)");
                line.setAttribute("stroke-width", "0.5");
                svg.appendChild(line);
            });

            const getXForDate = (isoDate) => {
                const d = new Date(isoDate);
                const day = d.getDate();
                if (day <= 7) return 12.5;
                if (day <= 14) return 37.5;
                if (day <= 21) return 62.5;
                return 87.5; 
            };

            const getPoints = (data) => {
                let points = "";
                data.forEach((item) => {
                    const x = getXForDate(item.date);
                    const heightPerc = (item.netUser / maxVal) * 80;
                    const y = 100 - heightPerc;
                    points += `${x},${y} `;
                });
                return points;
            };

            if (prevData.length > 0) {
                prevData.sort((a,b) => new Date(a.date) - new Date(b.date));
                const prevPoints = getPoints(prevData);
                const prevLine = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
                prevLine.setAttribute("points", prevPoints);
                prevLine.setAttribute("fill", "none");
                prevLine.setAttribute("stroke", monthColors[prevMonthIdx]);
                prevLine.setAttribute("stroke-width", "1.5"); 
                prevLine.setAttribute("stroke-opacity", "0.3");
                prevLine.setAttribute("stroke-dasharray", "4");
                svg.appendChild(prevLine);
            }

            if (currentData.length > 0) {
                currentData.sort((a,b) => new Date(a.date) - new Date(b.date));
                const currentColor = monthColors[currentMonthIdx];
                const currentPoints = getPoints(currentData);
                
                currentData.forEach((item) => {
                    const x = getXForDate(item.date);
                    const heightPerc = (item.netUser / maxVal) * 80;
                    const y = 100 - heightPerc;

                    const pointWrapper = document.createElement('div');
                    pointWrapper.className = 'absolute group flex flex-col items-center pointer-events-auto chart-point';
                    pointWrapper.style.left = `${x}%`;
                    pointWrapper.style.bottom = `${heightPerc}%`;
                    pointWrapper.style.transform = 'translateX(-50%)'; 
                    pointWrapper.style.marginBottom = '-6px'; 

                    const d = new Date(item.date);
                    let weekNum = Math.ceil(d.getDate() / 7);
                    if (weekNum > 4) weekNum = 4;
                    
                    pointWrapper.innerHTML = `
                        <div class="absolute bottom-full mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-black/90 border border-white/10 text-white text-[10px] p-2 rounded whitespace-nowrap z-10 pointer-events-none shadow-xl">
                            <span class="text-white/50 uppercase font-bold tracking-wider">Sem ${weekNum} (${d.getDate()}/${d.getMonth()+1})</span><br>
                            <span style="color:${currentColor}" class="font-bold text-sm">${formatCurrency(item.netUser)}</span>
                        </div>
                        <div class="w-3 h-3 bg-white rounded-full border-2 shadow-lg group-hover:scale-150 transition-transform cursor-pointer" style="border-color:${currentColor}"></div>
                    `;
                    container.appendChild(pointWrapper);
                });

                if (currentData.length > 1) {
                    const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
                    polyline.setAttribute("points", currentPoints);
                    polyline.setAttribute("fill", "none");
                    polyline.setAttribute("stroke", currentColor);
                    polyline.setAttribute("stroke-width", "3");
                    polyline.setAttribute("filter", "drop-shadow(0 0 4px " + currentColor + "80)"); 
                    
                    const firstX = getXForDate(currentData[0].date);
                    const lastX = getXForDate(currentData[currentData.length-1].date);
                    const polygonPoints = `${firstX},100 ${currentPoints} ${lastX},100`;

                    const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                    polygon.setAttribute("points", polygonPoints);
                    
                    const gradId = "grad" + currentMonthIdx + Math.random().toString(36).substr(2, 9); 
                    let defs = svg.querySelector('defs');
                    if(!defs) {
                        defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
                        svg.appendChild(defs);
                    }
                    const gradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
                    gradient.id = gradId;
                    gradient.setAttribute("x1", "0%"); gradient.setAttribute("y1", "0%");
                    gradient.setAttribute("x2", "0%"); gradient.setAttribute("y2", "100%");
                    gradient.innerHTML = `<stop offset="0%" style="stop-color:${currentColor};stop-opacity:0.3" /><stop offset="100%" style="stop-color:${currentColor};stop-opacity:0" />`;
                    defs.appendChild(gradient);
                    polygon.setAttribute("fill", `url(#${gradId})`);
                    
                    svg.appendChild(polygon);
                    svg.appendChild(polyline);
                }
            }

            container.appendChild(svg);
        }

        // --- INTERFAZ DIN√ÅMICA ---

        function generarInputsDias() {
            const container = document.getElementById('inputsDiasContainer');
            container.innerHTML = ''; 
            
            const sortedDays = [...selectedDays].sort((a, b) => a - b);
            if (sortedDays.length === 0) return;

            sortedDays.forEach(dayIndex => {
                const dayName = daysNames[dayIndex];
                const inputId = `dia_${dayName}`; 
                
                const wrapper = document.createElement('div');
                wrapper.className = 'flex flex-col space-y-1';
                
                const label = document.createElement('label');
                label.setAttribute('for', inputId);
                label.className = 'block text-xs font-bold text-white/60 ml-1';
                label.textContent = dayName.toUpperCase();
                
                const controlsContainer = document.createElement('div');
                controlsContainer.className = 'flex items-center gap-2';

                const btnCalc = document.createElement('button');
                btnCalc.className = 'control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold bg-indigo-500/20 border-indigo-500/30 text-indigo-300 hover:bg-indigo-500/40 hover:text-white transition-all shadow-[0_0_10px_rgba(99,102,241,0.1)]';
                btnCalc.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>';
                btnCalc.onclick = () => openCalculator(inputId);

                const btnMinus = document.createElement('button');
                btnMinus.className = 'control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold';
                btnMinus.innerHTML = '&minus;';
                
                const btnPlus = document.createElement('button');
                btnPlus.className = 'control-btn w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold';
                btnPlus.innerHTML = '&plus;';
                
                const inputContainer = document.createElement('div');
                inputContainer.className = 'relative flex-1';
                const symbol = document.createElement('span');
                symbol.className = 'absolute left-3 top-1/2 -translate-y-1/2 text-white/40';
                symbol.textContent = '$';
                const input = document.createElement('input');
                input.type = 'number';
                input.id = inputId;
                input.className = 'dia-input glass-input w-full rounded-xl pl-7 p-3 outline-none font-bold text-center transition-all';
                input.placeholder = "0";
                
                const savedVal = localStorage.getItem(inputId);
                if (savedVal) input.value = savedVal;

                input.addEventListener('input', (e) => { saveData(e); actualizarSeguimiento(); });
                setupLongPress(btnMinus, input, -500);
                setupLongPress(btnPlus, input, 500);

                inputContainer.appendChild(symbol);
                inputContainer.appendChild(input);
                controlsContainer.appendChild(btnCalc);
                controlsContainer.appendChild(btnMinus);
                controlsContainer.appendChild(inputContainer);
                controlsContainer.appendChild(btnPlus);
                wrapper.appendChild(label);
                wrapper.appendChild(controlsContainer);
                container.appendChild(wrapper);
            });
        }
        
        function setupLongPress(button, input, step) {
            let interval;
            let timeout;
            const modifyValue = () => {
                let current = parseFloat(input.value) || 0;
                current += step;
                if(current < 0) current = 0;
                input.value = current;
                input.dispatchEvent(new Event('input'));
            };
            const start = (e) => {
                if(e.type === 'touchstart') e.preventDefault();
                modifyValue(); 
                timeout = setTimeout(() => { interval = setInterval(modifyValue, 40); }, 300); 
            };
            const stop = () => { clearTimeout(timeout); clearInterval(interval); };
            button.addEventListener('mousedown', start);
            button.addEventListener('mouseup', stop);
            button.addEventListener('mouseleave', stop);
            button.addEventListener('touchstart', start);
            button.addEventListener('touchend', stop);
            button.addEventListener('touchcancel', stop);
        }

        // L√ìGICA DE C√ÅLCULO
        function performCalculation() {
            const precioRef = parseFloat(document.getElementById('precioReferencia').value) || 0;
            const metaLiquida = parseFloat(document.getElementById('metaLiquida').value) || 0;
            const countDias = selectedDays.length;
            
            const errorDiv = document.getElementById('error');
            const resultadoDiv = document.getElementById('resultado');
            const seguimientoDiv = document.getElementById('seguimiento');

            if (metaLiquida <= 0 || precioRef <= 0 || countDias <= 0) return;

            errorDiv.classList.add('hidden');
            metaLiquidaGoal = metaLiquida;
            precioCorteGoal = precioRef; 
            diasTrabajoGoal = countDias;

            const totalFacturar = metaLiquida / tuPorcentaje;
            const metaDiariaFacturar = totalFacturar / diasTrabajoGoal;
            const cortesPorDia = Math.ceil(metaDiariaFacturar / precioCorteGoal); 
            const facturacionDiariaAprox = cortesPorDia * precioCorteGoal;
            const facturacionSemanalAprox = facturacionDiariaAprox * diasTrabajoGoal;
            const gananciaLiquidaAprox = facturacionSemanalAprox * tuPorcentaje;
            const diferencia = gananciaLiquidaAprox - metaLiquida;

            document.getElementById('resMetaDiaria').textContent = formatCurrency(metaDiariaFacturar);
            document.getElementById('resCortesPorDia').textContent = cortesPorDia;
            document.getElementById('resGananciaProyectada').textContent = formatCurrency(gananciaLiquidaAprox);
            
            const diffEl = document.getElementById('resDiferenciaGanancia');
            if(diferencia > 0) {
                diffEl.textContent = `+ ${formatCurrency(diferencia)} extra`;
                diffEl.classList.remove('hidden');
            } else { diffEl.textContent = 'Exacto'; }
            
            updateServiceLabels();
            resultadoDiv.classList.remove('hidden');
            seguimientoDiv.classList.remove('hidden');
            generarInputsDias(); 
            actualizarSeguimiento();
        }

        function actualizarSeguimiento() {
            metaLiquidaGoal = parseFloat(document.getElementById('metaLiquida').value) || 0;
            precioCorteGoal = parseFloat(document.getElementById('precioReferencia').value) || 0;
            diasTrabajoGoal = selectedDays.length;

            const diasInputs = document.querySelectorAll('.dia-input');
            let totalFacturadoReal = 0;
            let diasCargados = 0;

            diasInputs.forEach(input => {
                const val = parseFloat(input.value) || 0;
                totalFacturadoReal += val;
                if (val > 0) diasCargados++;
            });

            const gananciaLiquidaReal = totalFacturadoReal * tuPorcentaje;
            const faltante = metaLiquidaGoal - gananciaLiquidaReal;

            document.getElementById('resTotalReal').textContent = formatCurrency(totalFacturadoReal);
            document.getElementById('resGananciaReal').textContent = formatCurrency(gananciaLiquidaReal);

            const faltanteWrapper = document.getElementById('resFaltanteWrapper');
            const exitoDiv = document.getElementById('mensajeExito');
            const cortesWrapper = document.getElementById('cortesFaltantesWrapper');
            const cortesSpan = document.getElementById('resCortesFaltantes');
            const promedioWrapper = document.getElementById('promedioFaltanteWrapper');
            const promedioSpan = document.getElementById('resPromedioFaltante');
            const promedioCortesSpan = document.getElementById('resPromedioCortes');
            
            updateServiceLabels();

            if (faltante > 100) { 
                exitoDiv.classList.add('hidden'); 
                faltanteWrapper.classList.remove('hidden');
                document.getElementById('resFaltante').textContent = formatCurrency(faltante);

                if (precioCorteGoal > 0) {
                    const faltanteBruto = faltante / tuPorcentaje;
                    const cortesFaltantes = Math.ceil(faltanteBruto / precioCorteGoal);
                    cortesSpan.textContent = cortesFaltantes;
                    cortesWrapper.classList.remove('hidden');
                } else { cortesWrapper.classList.add('hidden'); }

                let diasRestantesCalculo = diasTrabajoGoal - diasCargados;
                if (diasRestantesCalculo <= 0) diasRestantesCalculo = 0;

                if (diasRestantesCalculo > 0) {
                    const faltanteBruto = faltante / tuPorcentaje; 
                    const metaDiariaRestanteBruta = faltanteBruto / diasRestantesCalculo;
                    const serviciosDiariosRestantes = Math.ceil(metaDiariaRestanteBruta / precioCorteGoal);
                    promedioSpan.textContent = formatCurrency(metaDiariaRestanteBruta);
                    if(promedioCortesSpan) promedioCortesSpan.textContent = serviciosDiariosRestantes;
                    promedioWrapper.classList.remove('hidden');
                } else { promedioWrapper.classList.add('hidden'); }

            } else {
                faltanteWrapper.classList.add('hidden');
                exitoDiv.classList.remove('hidden');
                const extra = gananciaLiquidaReal - metaLiquidaGoal;
                document.getElementById('resExtra').textContent = formatCurrency(Math.max(0, extra));
            }
        }

        // EVENTOS
        document.getElementById('servicioSelector').addEventListener('change', function() {
            const precio = this.value;
            const input = document.getElementById('precioReferencia');
            input.value = precio;
            const selectedOption = this.options[this.selectedIndex];
            serviceName = selectedOption.getAttribute('data-name') || 'Cortes';
            localStorage.setItem('serviceName', serviceName);
            input.dispatchEvent(new Event('input'));
            if(document.getElementById('metaLiquida').value) performCalculation();
        });

        document.querySelectorAll('.save-input').forEach(input => { input.addEventListener('input', saveData); });
        document.querySelectorAll('.day-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const dayIndex = parseInt(this.getAttribute('data-day'));
                if (selectedDays.includes(dayIndex)) selectedDays = selectedDays.filter(d => d !== dayIndex);
                else selectedDays.push(dayIndex);
                saveSelectedDays();
                updateDayButtonsVisuals();
            });
        });

        document.getElementById('calcularBtn').addEventListener('click', function() {
            if (selectedDays.length === 0) {
                document.getElementById('error').classList.remove('hidden');
                return;
            }
            performCalculation();
            document.getElementById('resultado').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // NUEVO: L√ìGICA INTELIGENTE DE CIERRE DE SEMANA
        function saveToHistory(totalBruto) {
            // Guardar con fecha actual
            const entry = {
                date: new Date().toISOString(),
                totalBruto: totalBruto,
                netUser: totalBruto * tuPorcentaje,
                company: totalBruto * comisionPorcentaje
            };
            historyData.push(entry);
            localStorage.setItem('barber_history', JSON.stringify(historyData));
            renderHistorySection(); 
        }

        function resetUI() {
            daysNames.forEach(day => localStorage.removeItem(`dia_${day}`));
            const inputsDias = document.querySelectorAll('.dia-input');
            inputsDias.forEach(input => input.value = '');
            actualizarSeguimiento();
        }

        document.getElementById('resetBtn').addEventListener('click', function() {
            const diasInputs = document.querySelectorAll('.dia-input');
            let totalBruto = 0;
            diasInputs.forEach(input => { totalBruto += parseFloat(input.value) || 0; });
            
            // Verificar Meta
            const gananciaReal = totalBruto * tuPorcentaje;
            const meta = parseFloat(document.getElementById('metaLiquida').value) || 0;

            if (totalBruto > 0) {
                if (gananciaReal >= meta && meta > 0) {
                    saveToHistory(totalBruto);
                    showDialog("¬°Felicitaciones! üéâ", "Meta superada. La semana se ha guardado autom√°ticamente en tu historial.", () => {
                         resetUI();
                    }, null, "Genial");
                } else {
                    showDialog("Meta no alcanzada", "No alcanzaste la meta esta semana. ¬øQuer√©s guardar este registro en tu historial de todos modos?", 
                    () => { // S√ç, guardar
                        saveToHistory(totalBruto);
                        resetUI();
                    }, 
                    () => { // NO, preguntar si borrar
                         showDialog("¬øBorrar sin guardar?", "Se perder√°n los datos de esta semana permanentemente.", 
                         () => { // S√ç borrar
                             resetUI();
                         }, null, "Borrar", "Cancelar");
                    }, "Guardar", "No guardar");
                }
            } else {
                showDialog("Reiniciar", "¬øReiniciar semana? No hay datos ingresados.", () => resetUI(), null, "S√≠", "Cancelar");
            }
        });

        // FUNCIONES MODAL MANUAL
        function openManualModal() {
            const selectMonth = document.getElementById('manualMonth');
            const selectYear = document.getElementById('manualYear');
            
            selectMonth.innerHTML = '';
            selectYear.innerHTML = '';
            
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            const currentY = new Date().getFullYear();
            const today = new Date();

            for (let i = currentY - 1; i <= currentY + 1; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = i;
                if(i === currentY) opt.selected = true;
                selectYear.appendChild(opt);
            }

            monthNames.forEach((name, i) => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = name;
                if(i === today.getMonth()) opt.selected = true;
                selectMonth.appendChild(opt);
            });
            
            selectMonth.onchange = updateManualWeeksState;
            selectYear.onchange = updateManualWeeksState;

            document.getElementById('manualAmount').value = '';
            
            updateManualWeeksState(); 
            document.getElementById('manualModal').classList.add('open');
        }

        // MEJORA: Pre-llenado inteligente y chequeo visual
        function updateManualWeeksState() {
            renderManualCalendar(); 
            
            const month = parseInt(document.getElementById('manualMonth').value);
            const year = parseInt(document.getElementById('manualYear').value);
            
            document.querySelectorAll('.manual-week-btn').forEach(btn => {
                const wk = parseInt(btn.dataset.wk);
                const hasData = getExistingEntryIndex(year, month, wk) !== -1;
                
                if (hasData) {
                    btn.classList.add('filled');
                } else {
                    btn.classList.remove('filled');
                }
            });
            
            const currentSelected = parseInt(document.getElementById('manualWeekSelect').value) || 1;
            selectManualWeekFromButton(currentSelected); 
        }

        function renderManualCalendar() {
            const container = document.getElementById('manualCalendarContainer');
            container.innerHTML = '';
            
            const month = parseInt(document.getElementById('manualMonth').value);
            const year = parseInt(document.getElementById('manualYear').value);
            
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayIndex = new Date(year, month, 1).getDay(); 
            const startOffset = (firstDayIndex === 0 ? 6 : firstDayIndex - 1);

            for(let i=0; i<startOffset; i++) {
                const empty = document.createElement('div');
                container.appendChild(empty);
            }

            const highlightColor = monthColors[month];

            for(let d=1; d<=daysInMonth; d++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = d;
                
                let weekNum = 0;
                if(d <= 7) weekNum = 1;
                else if(d <= 14) weekNum = 2;
                else if(d <= 21) weekNum = 3;
                else weekNum = 4; // Max 4 weeks visualization

                dayEl.dataset.week = weekNum;
                
                if (getExistingEntryIndex(year, month, weekNum) !== -1) {
                    dayEl.classList.add('has-data');
                }
                
                dayEl.onclick = () => selectManualWeekFromButton(weekNum);
                
                container.appendChild(dayEl);
            }
        }

        function getExistingEntryIndex(year, month, week) {
            return historyData.findIndex(item => {
                const d = new Date(item.date);
                // Comparar A√±o y Mes
                if (d.getFullYear() !== year || d.getMonth() !== month) return false;
                
                const day = d.getDate();
                let itemWeek = 0;
                if (day <= 7) itemWeek = 1;
                else if (day <= 14) itemWeek = 2;
                else if (day <= 21) itemWeek = 3;
                else itemWeek = 4; // Clamp a 4
                
                return itemWeek === week;
            });
        }

        function selectManualWeekFromButton(wk) {
            const month = parseInt(document.getElementById('manualMonth').value);
            const year = parseInt(document.getElementById('manualYear').value);
            const color = monthColors[month];
            
            document.getElementById('manualWeekSelect').value = wk;
            document.getElementById('selectedWeekDisplay').innerHTML = `SEMANA ${wk} <span style="color:${color}">‚óè</span>`;
            document.getElementById('selectedWeekDisplay').style.color = color;

            document.querySelectorAll('.manual-week-btn').forEach(btn => {
                const btnWk = parseInt(btn.dataset.wk);
                if(btnWk === wk) {
                    btn.classList.add('bg-indigo-500', 'text-white');
                    btn.classList.remove('hover:bg-white/20');
                } else {
                    btn.classList.remove('bg-indigo-500', 'text-white');
                    btn.classList.add('hover:bg-white/20');
                }
            });

            // MEJORA: Rellenar Input si existe
            const existingIdx = getExistingEntryIndex(year, month, wk);
            const inputAmount = document.getElementById('manualAmount');
            const saveBtn = document.getElementById('btnSaveManual');
            
            if (existingIdx !== -1) {
                // Mostrar la GANANCIA del usuario, no el total bruto
                inputAmount.value = historyData[existingIdx].netUser;
                saveBtn.textContent = "Actualizar Registro";
                saveBtn.classList.add('bg-emerald-600', 'hover:bg-emerald-500');
                saveBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
            } else {
                inputAmount.value = '';
                saveBtn.textContent = "Guardar Nuevo Registro";
                saveBtn.classList.remove('bg-emerald-600', 'hover:bg-emerald-500');
                saveBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-500');
            }

            const days = document.querySelectorAll('.calendar-day');
            days.forEach(day => {
                const dayWk = parseInt(day.dataset.week);
                if(dayWk === wk) {
                    day.classList.add('selected');
                    day.style.backgroundColor = color;
                    day.style.color = '#1f2937'; 
                } else {
                    day.classList.remove('selected');
                    if(day.classList.contains('has-data')) {
                        day.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
                        day.style.color = '#86efac';
                    } else {
                        day.style.backgroundColor = 'transparent';
                        day.style.color = 'rgba(255,255,255,0.7)';
                    }
                }
            });
        }

        function closeManualModal() {
            document.getElementById('manualModal').classList.remove('open');
        }

        function saveManualEntry() {
            const month = parseInt(document.getElementById('manualMonth').value);
            const year = parseInt(document.getElementById('manualYear').value);
            const week = parseInt(document.getElementById('manualWeekSelect').value);
            
            // Dato ingresado es la GANANCIA DEL USUARIO
            const userProfit = parseFloat(document.getElementById('manualAmount').value);
            
            if(!userProfit || userProfit <= 0) {
                showDialog("Atenci√≥n", "Ingres√° un monto v√°lido.");
                return;
            }

            // Calcular TOTAL BRUTO inverso
            // Si userProfit = 55%, entonces Total = userProfit / 0.55
            const totalBruto = userProfit / tuPorcentaje;

            const existingIndex = getExistingEntryIndex(year, month, week);
            
            // Funci√≥n interna para proceder con el guardado
            const performSave = () => {
                if (existingIndex !== -1) {
                   historyData.splice(existingIndex, 1);
                }

                // Construir fecha
                const day = 1 + (week - 1) * 7;
                const dateObj = new Date(year, month, day, 12, 0, 0); 

                const entry = {
                    date: dateObj.toISOString(),
                    totalBruto: totalBruto,
                    netUser: userProfit,
                    company: totalBruto * comisionPorcentaje
                };
                
                historyData.push(entry);
                localStorage.setItem('barber_history', JSON.stringify(historyData));
                
                renderHistorySection();
                closeManualModal();
                showDialog("√âxito", "Registro guardado exitosamente.", null, null, "Ok");
            };

            if (existingIndex !== -1) {
                const existingAmount = formatCurrency(historyData[existingIndex].netUser);
                showDialog("Confirmar Sobrescritura", 
                    `Ya existe un registro para la Semana ${week} con una ganancia de ${existingAmount}.\n\n¬øDeseas SOBRESCRIBIRLO con el nuevo valor de $${userProfit}?`, 
                    performSave, null, "S√≠, sobrescribir");
            } else {
                performSave();
            }
        }

        // CALCULADORA FUNCIONES
        function openCalculator(targetId) {
            currentCalcInputId = targetId;
            calcExpression = '';
            calcResult = 0;
            updateCalcDisplay();
            document.getElementById('calculatorModal').classList.add('open');
        }

        function closeCalculator() {
            document.getElementById('calculatorModal').classList.remove('open');
            currentCalcInputId = null;
        }

        function calcInput(val) {
            const display = document.getElementById('calcDisplay');
            
            if (val === 'C') {
                calcExpression = '';
                calcResult = 0;
            } else if (val === 'DEL') {
                calcExpression = calcExpression.toString().slice(0, -1);
            } else if (val === '=') {
                try {
                    // Safe eval logic
                    const result = eval(calcExpression.replace(/[^-()\d/*+.]/g, ''));
                    calcResult = result || 0;
                    calcExpression = String(calcResult);
                } catch {
                    calcExpression = 'Error';
                    calcResult = 0;
                }
            } else {
                // Prevent multiple operators or dots if logic requires, but simple append works for now
                calcExpression += val;
                
                // Real-time provisional calc
                try {
                    const tempExp = calcExpression.replace(/[^-()\d/*+.]/g, '');
                    // Only eval if it doesn't end in operator
                    if (!['+', '-', '*', '/'].includes(tempExp.slice(-1))) {
                         calcResult = eval(tempExp) || 0;
                    }
                } catch {}
            }
            updateCalcDisplay();
        }

        function updateCalcDisplay() {
            document.getElementById('calcExpression').textContent = calcExpression;
            document.getElementById('calcDisplay').textContent = formatCurrency(calcResult);
            // Mostrar ganancia (55%)
            document.getElementById('calcProfitDisplay').textContent = formatCurrency(calcResult * tuPorcentaje);
        }

        function applyCalculatorResult() {
            if(currentCalcInputId && calcResult > 0) {
                let valueToApply = calcResult;
                
                // L√≥gica de "Aplicar":
                // Si estoy en Carga Manual (manualAmount), pego la GANANCIA (55%).
                // Si estoy en Seguimiento Diario (dia_...), pego el TOTAL BRUTO (100%).
                if(currentCalcInputId === 'manualAmount') {
                    valueToApply = calcResult * tuPorcentaje;
                }
                
                const input = document.getElementById(currentCalcInputId);
                if(input) {
                    input.value = parseFloat(valueToApply.toFixed(2)); // Round to avoid crazy decimals
                    input.dispatchEvent(new Event('input'));
                }
            }
            closeCalculator();
        }

        // INICIALIZACI√ìN
        loadAllData();
    </script>
</body>
</html>


